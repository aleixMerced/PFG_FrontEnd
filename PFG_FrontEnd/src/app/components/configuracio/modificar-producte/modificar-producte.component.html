<div class="config-wrapper">

  <button class="back-btn" (click)="tornarEnrere()">
    <mat-icon>arrow_back</mat-icon>
  </button>


  <div class="config-panel" *ngIf="producteSeleccionat">
    <h1 class="titol">Gestionar producte</h1>

    <!-- capçalera amb nom del producte i botó per canviar -->
    <div class="header-row">
      <div class="producte-info">
        <span class="label">Producte seleccionat</span>
        <span class="nom">{{ producteSeleccionat?.nomProducte }}</span>
      </div>

      <button class="secondary-btn small" type="button" (click)="canviarProducte()">
        Canviar producte
      </button>
    </div>

    <form class="producte-form">

      <!-- FORMULARI DADES PRODUCTE -->
      <div class="form-grid">

        <!-- Nom producte -->
        <div class="form-field">
          <label for="nomProducte">Nom del producte</label>
          <input
            id="nomProducte"
            name="nomProducte"
            [(ngModel)]="nomProducte"
            type="text"
            maxlength="10"
            required />
        </div>

        <!-- Tipus producte -->
        <div class="form-field">
          <label for="tipusProducte">Tipus de producte</label>
          <select
            id="tipusProducte"
            name="tipusProducte"
            [(ngModel)]="tipusSeleccionat">
            <option [ngValue]="null" disabled>Selecciona un tipus</option>
            <option
              *ngFor="let tipus of tipusProductes"
              [ngValue]="tipus">
              {{ tipus.nomTipus }}
            </option>
          </select>
        </div>

        <!-- Preu venda -->
        <div class="form-field">
          <label for="preuVenda">Preu de venda (€)</label>
          <input
            id="preuVenda"
            name="preuVenda"
            type="text"
            [value]="preuVenda ?? ''"
            readonly
            (click)="obrirTeclat('preuVenda')" />
        </div>

        <!-- Preu compra -->
        <div class="form-field">
          <label for="preuCompra">Preu de compra (€)</label>
          <input
            id="preuCompra"
            name="preuCompra"
            type="text"
            [value]="preuCompra ?? ''"
            readonly
            (click)="obrirTeclat('preuCompra')" />
        </div>

        <!-- Estoc -->
        <div class="form-field">
          <label for="estoc">Estoc</label>
          <input
            id="estoc"
            name="estoc"
            type="text"
            [value]="estoc ?? ''"
            readonly
            (click)="obrirTeclat('estoc')" />
        </div>

        <!-- Mínim estoc -->
        <div class="form-field">
          <label for="minimEstoc">Mínim d'estoc</label>
          <input
            id="minimEstoc"
            name="minimEstoc"
            type="text"
            [value]="minimEstoc ?? ''"
            readonly
            (click)="obrirTeclat('minimEstoc')" />
        </div>

        <!-- Imatge producte -->
        <div class="form-field form-field-full">
          <label for="imatgeProducte">Imatge del producte</label>

          <div class="imatge-grid">
            <!-- previsualització imatge actual -->
            <div class="imatge-preview" *ngIf="imatgeUrl">
              <img [src]="imatgeUrl" alt="Imatge producte" />
            </div>

            <!-- upload nova imatge -->
            <div class="file-input-wrapper">
              <input
                id="imatgeProducte"
                name="imatgeProducte"
                type="file"
                accept="image/*"
                (change)="onImatgeSeleccionada($event)" />

              <span class="file-input-label">
                {{ nomImatge || 'Canvia la imatge del producte' }}
              </span>
            </div>
          </div>
        </div>

      </div>

      <!-- BOTONS ACCIONS -->
      <div class="form-actions">
        <button class="primary-btn" type="button" (click)="modificarProducte()">
          Modificar
        </button>

        <button class="danger-btn" type="button" (click)="mostraConfirmacioEliminar = true">
          Eliminar
        </button>

        <button class="secondary-btn" type="button" (click)="cancelLar()">
          Cancel·lar
        </button>
      </div>

    </form>
  </div>

  <!-- POPUP TECLAT NUMÈRIC -->
  <div class="overlay" *ngIf="mostraTeclat">
    <div class="overlay-backdrop" (click)="tancarTeclat()"></div>

    <div class="overlay-panel">
      <app-teclat-numeric
        [title]="teclatTitle"
        [initialValue]="valorTeclatInicial"
        (ok)="onTeclatOk($event)"
        (close)="tancarTeclat()">
      </app-teclat-numeric>
    </div>
  </div>

  <!-- POPUP CONFIRMACIÓ ELIMINAR PRODUCTE -->
  <div class="overlay" *ngIf="mostraConfirmacioEliminar">
    <div class="overlay-backdrop" (click)="mostraConfirmacioEliminar = false"></div>

    <div class="overlay-panel confirm-panel">
      <h2 class="confirm-title">Estàs segur d'eliminar aquest producte?</h2>
      <p class="confirm-text">
        {{ producteSeleccionat?.nomProducte }}
      </p>

      <div class="confirm-actions">
        <button
          type="button"
          class="danger-btn"
          (click)="eliminarProducte()">
          Confirmar
        </button>

        <button
          type="button"
          class="secondary-btn"
          (click)="mostraConfirmacioEliminar = false">
          Cancel·lar
        </button>
      </div>
    </div>
  </div>

</div>
